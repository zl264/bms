<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title th:text="${congress.getTitle()}"></title>

    <!-- Bootstrap -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .td1{
            width: 300px;
        }
        table{
            width: 50%;
            text-align: center;
            margin-top: 150px;
        }
    </style>

    <script src="js/html5shiv.min.js"></script>
    <script src="js/respond.min.js"></script>

</head>
<body>

<!--判断进入这个会议的是不是会议组织者-->
<div th:if="${session.loginUser} eq ${organizerName}">
    <h2>会议的基本信息</h2>
    <form style="text-align: left;margin-top: 150px;margin-left: 300px" method="post" th:action="@{/organizer/alter}">
        <input type="hidden" name="congressId" th:value="${congress.getCongressId()}" th:if="${congress.getCongressId()}">
        会议名称:<input type="text" name="title" th:value="${congress.getTitle()}"/><br>
        内容:<textarea name="content" th:text="${congress.getContent()}"></textarea><br>
        地点:<input type="text" name="place" th:value="${congress.getPlace()}"/><br>
        <tr>
            <td class="td_left"><lable for="startTime">会议开始时间：</lable></td>
            <td class="td_right"><input type="datetime-local" name="startTime" th:value="${congress.getStartTime()}" id="startTime" ></td>
        </tr>
        <tr>
            <td class="td_left"><lable for="endTime">会议结束时间：</lable></td>
            <td class="td_right"><input type="datetime-local" name="endTime" th:value="${congress.getEndTime()}" id="endTime" ></td>
        </tr>
        <tr>
            <td class="td_left"><lable for="registerStartTime">申请会议开始时间：</lable></td>
            <td class="td_right"><input type="datetime-local" name="registerStartTime" th:value="${congress.getRegisterStartTime()}" id="registerStartTime" ></td>
        <tr>
        <tr>
            <td class="td_left"><lable for="registerEndTime">申请会议结束时间：</lable></td>
            <td class="td_right"><input type="datetime-local" name="registerEndTime" th:value="${congress.getRegisterEndTime()}" id="registerEndTime" ></td>
        </tr>
        <button class="btn btn-lg btn-primary btn-block" type="submit">保存</button>
    </form>


    <h2>参加会议的人员</h2>
    <!--    <h5>填写了到达时间和到达地点的人员</h5>-->
    <div th:if="${participants.size()==0}">
        暂无参会人员
    </div>
    <div class="table-responsive" th:if="${participants.size()!=0}">
        <table class="table table-striped table-sm">
            <thead>
            <tr>
                <th>昵称</th>
                <th>姓名</th>
                <th>年龄</th>
                <th>性别</th>
                <th>身份</th>
                <th>电话号码</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="participant:${participants}">
                <td th:text="${participant.getUsername()}"></td>
                <td th:text="${participant.getName()}"></td>
                <td th:text="${participant.getAge()}"></td>
                <td th:text="${participant.getSex()}"></td>
                <td th:text="${participant.getIdentity()}"></td>
                <td th:text="${participant.getTel()}"></td>
                <td>
                    <a class="btn btn-sm btn-primary" th:href=" @{/organizer/delete/participant}+
                    '?commonId='+${participant.getCommonId()}+'&congressId='+${congress.getCongressId()}">删除</a>
                    <!--                    <button th:attr="del_uri=@{/emp/}+${emp.id}" class="btn btn-sm btn-danger deleteBtn">删除</button>-->
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <h5>需要接送的人员</h5>
    <div th:if="${allInformationParticipants.size()==0}">
        暂时没人需要接送
    </div>
    <div class="table-responsive" th:if="${allInformationParticipants.size()!=0}">
        <!--        显示到达地点的人数-->
        <div th:if="${allArrivalPlace.size()!=0}">
            <table>
                <thead>
                <tr>
                    <th>到达地点</th>
                    <th>人数</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="aPlace:${allArrivalPlace}">
                    <th th:text="${aPlace.getArrivalPlace()}" th:if="${aPlace.getArrivalPlace()!=null}"></th>
                    <th th:text="${aPlace.getNum() }" th:if="${aPlace.getNum()!=0}"></th>
                </tr>
                </tbody>
            </table>
        </div>
        <table class="table table-striped table-sm">
            <thead>
            <tr>
                <th>昵称</th>
                <th>姓名</th>
                <th>年龄</th>
                <th>性别</th>
                <th>身份</th>
                <th>电话号码</th>
                <th>到达时间</th>
                <th>到达地点</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="allInformationParticipant:${allInformationParticipants}">
                <td th:text="${allInformationParticipant.getUsername()}"></td>
                <td th:text="${allInformationParticipant.getName()}"></td>
                <td th:text="${allInformationParticipant.getAge()}"></td>
                <td th:text="${allInformationParticipant.getSex()}"></td>
                <td th:text="${allInformationParticipant.getIdentity()}"></td>
                <td th:text="${allInformationParticipant.getTel()}"></td>
                <td th:text="${allInformationParticipant.getArrivalPlace()}"></td>
                <td th:text="${#temporals.format(allInformationParticipant.getArrivalTime(),'yyyy-MM-dd HH:mm')}"></td>
            </tr>
            </tbody>
        </table>
        <!--        分配司机-->
        <form>
            <input type="hidden" id="congress" th:value="${congress.getCongressId()}">
            <input type="button" onclick="allocationFunc()" value="给参会人员分配司机">
        </form>

    </div>

    <h2>酒店</h2>




    <h2>车队</h2>
    <a th:href="@{/organizer/driver/}+${congress.getCongressId()}" style="display: block;background-color: #31b0d5;">查看所有司机</a>
    <h5>会议已有的司机</h5>
    <ul style="margin-top: 10px">
        <li th:each="driver:${hasDriver}">
            司机呢称:<span th:text="${driver.getUsername()}"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            司机电话:<span th:text="${driver.getTel()}"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            载客容量:<span th:text="${driver.getCapacity()}"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <!--            接送地点:<span th:text="${driver.getPlace()!=null?driver.getPlace():'暂未分配接送地点'}"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-->
            已分配人数:<span th:text="${driverHaveNum[driver.getDriverId()]}"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <a th:href="@{/organizer/driver/list/}+${congress.getCongressId()}+'/'+${driver.getDriverId()}">接送人员名单</a>
        </li>
    </ul>

</div>

<!--判断进入这个会议的是不是非会议组织者-->
<div th:unless="${session.loginUser} eq ${organizerName}">
    <div>
        <table>
            <caption th:text="${congress.getTitle()}"></caption>
            <tr>
                <td class="td1">组织者:</td>
                <td th:text="${organizerName}"></td>
            </tr>
            <tr>
                <td class="td1">内容:</td>
                <td th:text="${congress.getContent()}"></td>
            </tr>
            <tr>
                <td class="td1">地点:</td>
                <td th:text="${congress.getPlace()}"></td>
            </tr>
            <tr>
                <td class="td1">开始时间:</td>
                <td th:text="${#temporals.format(congress.getStartTime(),'yyyy-MM-dd HH:mm')}"></td>
            </tr>
            <tr>
                <td class="td1">结束时间:</td>
                <td th:text="${#temporals.format(congress.getEndTime(),'yyyy-MM-dd HH:mm')}"></td>
            </tr>
            <tr>
                <td class="td1">会议开始时间:</td>
                <td th:text="${#temporals.format(congress.getRegisterStartTime(),'yyyy-MM-dd HH:mm')}"></td>
            </tr>
            <tr>
                <td class="td1">会议结束时间:</td>
                <td th:text="${#temporals.format(congress.getRegisterEndTime(),'yyyy-MM-dd HH:mm')}"></td>
            </tr>
        </table>
    </div>
    <input th:if="${error}" th:text="${error}"/>
    <!--    当前用户是否已经参加会议-->
    <form th:if="${record}!=null" style="margin-top: 50px;">
        <input type="hidden" name="congressId" th:value="${congress.getCongressId()}">
        <button class="btn btn-lg btn-primary btn-block" style="text-align: center">退出会议</button>
    </form>

    <form th:unless="${record}!=null" style="margin-top: 50px;" th:action="@{/participant/attend}">
        <input type="hidden" name="congressId" th:value="${congress.getCongressId()}">
        <button class="btn btn-lg btn-primary btn-block" th:if="${canRegisterCongress}!=null and ${participantInformation}!=null" style="text-align: center">参加会议</button>
        <span th:if="${canRegisterCongress}==null">未在报名时间范围内</span>
        <span th:if="${participantInformation}==null">请填写完个人信息之后再参加会议</span>
    </form>
    <form th:if="${record}!=null" th:action="@{/organizer/arrival/}+${congress.getCongressId()}" method="post">
        <span style="color: red" th:if="${record.getArrivalPlace()==null}">注意：请填写到达时间和地点，不填写无法安排接送</span><br>
        到达地点：<input type="text" name="arrivalPlace" th:value="${record.getArrivalPlace()!=null?record.getArrivalPlace():''}"><br>
        到达时间：
        <input type="datetime-local" name="arrivalTime" th:value="${record.getArrivalTime()!=null?record.getArrivalTime():''}">
        <input type="submit" value="保存"/>
        <!--        onclick="setArrivalInformation()"-->
    </form>
</div>

<!--用户名<p th:text="${session.loginUser}"></p>-->

<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
<script src="/js/jquery.min.js"></script>
<!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
<script src="/js/bootstrap.min.js"></script>

<script src="/js/common.js"></script>
<script>
    function allocationFunc(){
        initAJAX();
        var congressId = document.getElementById("congress").value;
        xmlHttp.open("GET", "/organizer/allocation?congressId="+congressId, true);
        xmlHttp.onreadystatechange = function () {
            if (xmlHttp.readyState == 4) {
                window.location.href = "/congress/"+congressId;
            }
        }
        xmlHttp.send();
    }
</script>
<!--<script th:inline="javascript">-->
<!--    function setArrivalInformation(){-->
<!--        var arrivalPlace = document.getElementById("arrivalPlace");-->
<!--        var arrivalTimeYear = document.getElementById("arrivalTimeYear");-->
<!--        var arrivalTimeMonth = document.getElementById("arrivalTimeMonth");-->
<!--        var arrivalTimeDay = document.getElementById("arrivalTimeDay");-->
<!--        var arrivalTimeHour = document.getElementById("arrivalTimeHour");-->
<!--        var arrivalTimeMinute = document.getElementById("arrivalTimeMinute");-->
<!--        xmlHttp.open("POST", "/organizer/arrival/"+[[${congress.getCongressId()}]]+"?arrivalPlace="-->
<!--            +arrivalPlace.value+"?arrivalTimeYear=" +arrivalTimeYear.value+"?arrivalTimeMonth=" +arrivalTimeMonth.value-->
<!--            +"?arrivalTimeDay=" +arrivalTimeDay.value+"?arrivalTimeHour=" +arrivalTimeHour.value-->
<!--            +"?arrivalTimeMinute=" +arrivalTimeMinute.value, true);-->
<!--        xmlHttp.onreadystatechange = function () {-->
<!--            if (xmlHttp.readyState == 4) {-->
<!--                var data = xmlHttp.responseText;-->
<!--                var obj = JSON.parse(data);-->

<!--                arrivalPlace.value = obj["arrivalPlace"];-->
<!--                alert(obj["arrivalTime"]);-->
<!--            }-->
<!--        }-->
<!--    xmlHttp.send();-->
<!--    }-->
<!--</script>-->
</body>
</html>